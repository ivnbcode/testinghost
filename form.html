<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Solicitud de Certificado</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.28.0/feather.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background-color: #fff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #fff;
            background-color: #333;
            padding: 25px;
            margin: -30px -30px 30px -30px;
            border-radius: 12px 12px 0 0;
            font-weight: 300;
            letter-spacing: 1px;
        }
        form {
            display: grid;
            gap: 20px;
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #666;
        }
        .btn {
            display: inline-block;
            background-color: #333;
            color: #fff;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #555;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .error {
            color: #ff0000;
            font-size: 0.9em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i data-feather="file-text" class="icon"></i> Formulario de Solicitud de Certificado</h1>
        
        <form id="certificateForm">
            <div>
                <label for="cedula">Cédula:</label>
                <input type="text" id="cedula" name="cedula" required>
                <span class="error" id="cedulaError"></span>
            </div>
            <div>
                <label for="primer_nombre">Primer Nombre:</label>
                <input type="text" id="primer_nombre" name="primer_nombre" required>
                <span class="error" id="primerNombreError"></span>
            </div>
            <div>
                <label for="segundo_nombre">Segundo Nombre:</label>
                <input type="text" id="segundo_nombre" name="segundo_nombre">
                <span class="error" id="segundoNombreError"></span>
            </div>
            <div>
                <label for="primer_apellido">Primer Apellido:</label>
                <input type="text" id="primer_apellido" name="primer_apellido" required>
                <span class="error" id="primerApellidoError"></span>
            </div>
            <div>
                <label for="segundo_apellido">Segundo Apellido:</label>
                <input type="text" id="segundo_apellido" name="segundo_apellido">
                <span class="error" id="segundoApellidoError"></span>
            </div>
            <div>
                <label for="telefono">Teléfono:</label>
                <input type="tel" id="telefono" name="telefono" required>
                <span class="error" id="telefonoError"></span>
            </div>
            <div>
                <label for="correo">Correo:</label>
                <input type="email" id="correo" name="correo" required>
                <span class="error" id="correoError"></span>
            </div>
            <div>
                <label for="empresa">Empresa:</label>
                <select id="empresa" name="empresa" required>
                    <option value="">Seleccione una empresa</option>
                    <option value="empresa1">Empresa 1</option>
                    <option value="empresa2">Empresa 2</option>
                    <option value="empresa3">Empresa 3</option>
                </select>
            </div>
            <div>
                <label for="cantidad">Cantidad:</label>
                <input type="number" id="cantidad" name="cantidad" min="1" max="5" required>
                <span class="error" id="cantidadError"></span>
            </div>
            <div>
                <label for="numero_recibo">Número de Recibo:</label>
                <input type="text" id="numero_recibo" name="numero_recibo" required>
                <span class="error" id="numeroReciboError"></span>
            </div>
            <div>
                <label for="origen_de_recursos">Origen de Recursos:</label>
                <select id="origen_de_recursos" name="origen_de_recursos" required>
                    <option value="">Seleccione un origen</option>
                    <option value="origen1">Origen 1</option>
                    <option value="origen2">Origen 2</option>
                    <option value="origen3">Origen 3</option>
                </select>
            </div>
            <div>
                <label for="radicado">Radicado:</label>
                <input type="text" id="radicado" name="radicado" readonly>
            </div>
            <button type="submit" class="btn">Enviar Solicitud</button>
        </form>
    </div>

    <script>
        feather.replace({ color: '#666', stroke: '#666' });

        function generateRadicado() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 10; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function validateForm() {
            let isValid = true;
            const form = document.getElementById('certificateForm');
            const fields = form.elements;

            for (let i = 0; i < fields.length; i++) {
                const field = fields[i];
                const errorSpan = document.getElementById(field.id + 'Error');
                if (errorSpan) errorSpan.textContent = '';

                if (field.type !== 'submit' && field.hasAttribute('required') && !field.value) {
                    errorSpan.textContent = 'Este campo es requerido';
                    isValid = false;
                } else {
                    switch (field.id) {
                        case 'primer_nombre':
                        case 'segundo_nombre':
                        case 'primer_apellido':
                        case 'segundo_apellido':
                            if (field.value && /\s /.test(field.value)) {
                                errorSpan.textContent = 'No se permiten espacios';
                                isValid = false;
                            }
                            break;
                        case 'telefono':
                            if (field.value && (field.value.length < 7 || field.value.length > 10 || !/^\d+$/.test(field.value))) {
                                errorSpan.textContent = 'Debe tener entre 7 y 10 dígitos';
                                isValid = false;
                            }
                            break;
                        case 'correo':
                            if (field.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(field.value)) {
                                errorSpan.textContent = 'Correo electrónico inválido';
                                isValid = false;
                            }
                            break;
                        case 'numero_recibo':
                            if (field.value && !/^\d+$/.test(field.value)) {
                                errorSpan.textContent = 'Solo se permiten números';
                                isValid = false;
                            }
                            break;
                    }
                }
            }

            return isValid;
        }

        document.getElementById('certificateForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (validateForm()) {
                const radicado = generateRadicado();
                document.getElementById('radicado').value = radicado;
                
                const formData = new FormData(this);
                const data = Object.fromEntries(formData.entries());
                
                fetch('https://script.google.com/macros/s/AKfycbwenSldVGTkoMXO4aeHKBtarrEM8bhSYjsJIgFXZgA/dev', {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        alert(`Solicitud radicada con éxito. Su número de radicado es: ${radicado}`);
                        this.reset();
                    } else {
                        alert('Hubo un error al procesar su solicitud. Por favor, intente de nuevo.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Hubo un error al enviar su solicitud. Por favor, intente de nuevo.');
                });
            }
        });

        // Generar radicado cuando todos los campos estén llenos
        const form = document.getElementById('certificateForm');
        const fields = form.elements;
        for (let i = 0; i < fields.length; i++) {
            fields[i].addEventListener('input', function() {
                let allFilled = true;
                for (let j = 0; j < fields.length; j++) {
                    if (fields[j].type !== 'submit' && fields[j].hasAttribute('required') && !fields[j].value) {
                        allFilled = false;
                        break;
                    }
                }
                if (allFilled) {
                    document.getElementById('radicado').value = generateRadicado();
                }
            });
        }
    </script>
</body>
</html>